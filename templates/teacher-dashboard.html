{% extends "base.html" %}
{% load static %}
{% block extra_links %}
<link rel="stylesheet" href="{% static 'css/form.css' %}">
<script src="{% static 'js/massage.js' %}"></script>
<script>
  function enableEdit(id) {
    let row = document.getElementById(`row-${id}`);
    let button = document.getElementById(`btn-${id}`);

    if (button.dataset.mode === "edit") {
        // Second click → submit
        row.querySelector('form').submit();
    } else {
        // First click → enable edit mode
        row.querySelectorAll('.view-mode').forEach(el => el.style.display = 'none');
        row.querySelectorAll('.edit-mode').forEach(el => el.style.display = 'block');

        button.innerText = 'Save';
        button.classList.remove('btn-success');
        button.classList.add('btn-primary');

        // Mark button as edit mode
        button.dataset.mode = "edit";
    }
}
function enableAdd() {
    let row = document.getElementById('new-row');
    let button = document.getElementById('add-btn');

    if (button.dataset.mode === "edit") {
        button.type = "submit"; // Yaha galti thi — ab ye form submit karega
    } else {
        row.querySelectorAll('.edit-mode').forEach(el => el.style.display = 'block');
        button.innerText = 'Save';
        button.classList.remove('btn-success');
        button.classList.add('btn-primary');
        button.dataset.mode = "edit";
    }
}
</script>

{% endblock %}
{% block content %}
      <main>
        {% include "usernav.html" %}
        {% if messages %}
        <div id="message-container">
            {% for message in messages %}
            <h5 class="text-center text-danger">{{ message | safe }}</h5>
            {% endfor %}
        </div>
        {% endif %}
            <div class="row">
              <div class="col-sm-11 mx-auto mt-5 mb-5" id="boxes" style="box-shadow: 5px 10px 25px #000; padding: 30px; width: 90%; margin:auto; border-radius: 10px;">
                <h2 class="text-center">Contents</h2>
                <div class="table-responsive">
                    <table class="table table-striped table-bordered" style="border: black; width: 90%;">
                    <thead>
                        <tr class="text-center">
                        <th scope="col" style="background-color: #9DC3E6;">SR. No.</th>
                        <th scope="col" style="background-color: #9DC3E6;">Title</th>
                        <th scope="col" style="background-color: #9DC3E6;">Content Type</th>
                        <th scope="col" style="background-color: #9DC3E6;">Discription</th>
                        <th scope="col" style="background-color: #9DC3E6;">File</th>
                        <th scope="col" style="background-color: #9DC3E6;" colspan="2">For</th>
                        <th scope="col" style="background-color: #9DC3E6;" colspan="2">Action</th>
                        </tr>
                    </thead>
                    <tbody>                           
                        {% for n in data %}
                        <tr id="row-{{ n.id }}">
                                <form method="post" enctype="multipart/form-data" action="{% url 'update_content' n.id %}">
                                {% csrf_token %}
                                <input type="hidden" name="form_type" value="update">
                                <th scope="row" class="text-center">{{ forloop.counter }}</th>

                                <!-- Title -->
                                <td class="text-center">
                                    <span class="view-mode">{{ n.content_title }}</span>
                                    <input type="text" placeholder="Enter title" name="content_title" value="{{ n.content_title }}" class="edit-mode" style="display:none; width: 100%; height: 1cm; border: none;">
                                </td>

                                <!-- Type -->
                                <td class="text-center">
                                    <span class="view-mode">{{ n.content_type }}</span>
                                    <select name="content_type" class="edit-mode" style="display:none; width: 100%; height: 1cm; border: none;">
                                        <option value="Notes" {% if n.content_type == "Notes" %}selected{% endif %}>Notes</option>
                                        <option value="Assignment" {% if n.content_type == "Assignment" %}selected{% endif %}>Assignment</option>
                                        <option value="Lecture" {% if n.content_type == "Lecture" %}selected{% endif %}>Lecture</option>
                                    </select>
                                </td>

                                <!-- Description -->
                                <td>
                                    <span class="view-mode">{{ n.content_desc }}</span>
                                    <textarea name="content_desc" class="edit-mode" placeholder="Enter description" style="display:none; width: 100%; height: 1cm; border: none; resize:none;">{{ n.content_desc }}</textarea>
                                </td>

                                <!-- File / URL-->
                                <td class="text-center">
                                    {% if n.content_file %}
                                        <a href="{{ n.content_file.url }}" target="_blank"><span class="view-mode">{{ n.filename }}</span></a>
                                    {% elif n.content_link %}
                                        <a href="{{ n.content_link }}" target="_blank"><span class="view-mode">{{ n.content_link }}</span></a>
                                    {% endif %}

                                    <!-- Edit Mode Inputs -->
                                    <input type="file" name="content_file" class="edit-mode" style="display:none; width: 100%; border:none;">
                                    <input type="url" name="content_link" placeholder="Enter URL or select file" class="edit-mode" style="display:none; width: 100%; border:none;">
                                </td>

                                <!-- branch -->
                                <td class="text-center">
                                    <span class="view-mode">{{ n.to_branch }}</span>
                                    <select name="to_branch" class="edit-mode" style="display:none; width: 100%; height: 1cm; border: none;">
                                        <option value="CSE" {% if n.to_branch == "CSE" %}selected{% endif %}>CSE</option>
                                        <option value="EC" {% if n.to_branch == "EC" %}selected{% endif %}>EC</option>
                                        <option value="IC" {% if n.to_branch == "IC" %}selected{% endif %}>IC</option>
                                        <option value="All Branch" {% if n.to_branch == "All Branch" %}selected{% endif %}>All Branch</option>
                                    </select>
                                </td>

                                <!-- year -->
                                <td class="text-center">
                                    <span class="view-mode">{{ n.to_year }}</span>
                                    <select name="to_year" class="edit-mode" style="display:none; width: 100%; height: 1cm; border: none;">
                                        <option value="1st Year" {% if n.to_year == "1st Year" %}selected{% endif %}>1st Year</option>
                                        <option value="2nd Year" {% if n.to_year == "2nd Year" %}selected{% endif %}>2nd Year</option>
                                        <option value="3rd Year" {% if n.to_year == "3rd Year" %}selected{% endif %}>3rd Year</option>
                                        <option value="All Year" {% if n.to_year == "All Year" %}selected{% endif %}>All Year</option>
                                    </select>
                                </td>


                                <!-- Actions -->
                                <td class="text-center">
                                    <button type="button" class="btn btn-success" id="btn-{{ n.id }}" data-mode="view" onclick="enableEdit({{ n.id }})">Update</button>
                                </td>
                                <td class="text-center">
                                    <a href="{% url 'delete_content' n.id %}" onclick="return confirm('Are you sure you want to delete this?');">
                                        <button type="button" class="btn btn-danger">Delete</button>
                                    </a>
                                </td>
                                </form>
                        </tr>
                        {% endfor %}

                        <!-- Add New Row -->
                        <tr id="new-row">
                            <form method="post" enctype="multipart/form-data" action="{% url 'teacher_dashboard' %}">
                            {% csrf_token %}
                            <input type="hidden" name="form_type" value="add">
                            <th class="text-center">-</th>

                            <!-- Title -->
                            <td class="text-center">
                                <input type="text" placeholder="Enter title" name="content_title" class="edit-mode mt-4" style="display:none; width: 100%; height: 1cm; border:none;" required>
                            </td>

                            <!-- Type -->
                            <td class="text-center">
                                <select name="content_type" class="edit-mode mt-4" style="display:none; width: 100%; height: 1cm; border:none;" required>
                                    <option value="" disabled selected>Select Type</option>
                                    <option value="Notes">Notes</option>
                                    <option value="Assignment">Assignment</option>
                                    <option value="Lecture">Lecture</option>
                                </select>
                            </td>

                            <!-- Description -->
                            <td>
                                <textarea name="content_desc" placeholder="Enter description" class="edit-mode" style="display:none; width: 100%; height: 2.5cm; border:none; resize:none;"></textarea>
                            </td>

                            <!-- File / URL -->
                                <td class="text-center">
                                    <input type="file" name="content_file" class="edit-mode" style="display:none;">
                                    <input type="url" name="content_link" placeholder="Enter link or select file" class="edit-mode mt-3" style="display:none; width: 100%; height: 1cm; border:none;">
                                </td>


                            <!-- branch -->
                            <td class="text-center">
                                <select name="to_branch" class="edit-mode mt-4" style="display:none; width: 100%; height: 1cm; border:none;" required>
                                    <option value="" disabled selected>Select Branch</option>
                                    <option value="CSE">CSE</option>
                                    <option value="EC">EC</option>
                                    <option value="IC">IC</option>
                                    <option value="All Branch">All Branch</option>
                                </select>
                            </td>

                            <!-- year -->
                            <td class="text-center">
                                <select name="to_year" class="edit-mode mt-4" style="display:none; width: 100%; height: 1cm; border:none;" required>
                                    <option value="" disabled selected>Select Year</option>
                                    <option value="1st Year">1st Year</option>
                                    <option value="2nd Year">2nd Year</option>
                                    <option value="3rd Year">3rd Year</option>
                                    <option value="All Year">All Year</option>
                                </select>
                            </td>

                            <!-- Action -->
                            <td colspan="2" class="text-center">
                                <button type="button" id="add-btn" class="btn btn-primary mt-4" onclick="enableAdd()">Add</button>
                            </td>
                            </form>
                        </tr>
                    </tbody>
                    </table>
                </div>
              </div>
            </div>
      </main>
{% endblock %}